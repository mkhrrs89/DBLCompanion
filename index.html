<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DBL / BBGM Drama Companion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f1e8;
      --paper: #f9f6ef;
      --ink: #1f1a17;
      --muted: #6b5e52;
      --accent: #9b1b1b;
      --accent-soft: rgba(155, 27, 27, 0.09);
      --accent-border: rgba(155, 27, 27, 0.6);
      --danger: #b03030;
      --radius-lg: 12px;
      --radius-sm: 6px;
      --shadow-soft: 0 14px 28px rgba(31, 26, 23, 0.12);
      --shadow-sm: 0 6px 14px rgba(31, 26, 23, 0.12);
      --grid-line: rgba(31, 26, 23, 0.08);
      --edge: #cfc3b1;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Merriweather", "Georgia", "Times New Roman", serif;
      background: repeating-linear-gradient(
          0deg,
          transparent,
          transparent 32px,
          var(--grid-line) 32px,
          var(--grid-line) 33px
        ),
        linear-gradient(135deg, #f2ede3, #f8f5ee);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px 12px 36px;
    }

    .app-shell {
      max-width: 1100px;
      width: 100%;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 18px;
    }

    @media (max-width: 880px) {
      .app-shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: var(--paper);
      border-radius: 10px;
      border: 1px solid var(--edge);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      position: relative;
      overflow: hidden;
    }

    .panel::before,
    .panel::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .panel::before {
      background: radial-gradient(circle at 12% 12%, rgba(0, 0, 0, 0.04), transparent 36%),
        radial-gradient(circle at 88% 8%, rgba(155, 27, 27, 0.08), transparent 32%);
      opacity: 0.8;
    }

    .panel::after {
      border: 1px solid rgba(31, 26, 23, 0.07);
      border-radius: 8px;
      inset: 8px;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.6rem;
      letter-spacing: 0.06em;
      display: flex;
      align-items: center;
      gap: 8px;
      font-variant: small-caps;
      color: var(--ink);
    }

    h1 span.logo-pill {
      font-size: 0.72rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--edge);
      background: linear-gradient(180deg, #fdfbf6, #f1eadf);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
    }

    .subtitle {
      margin: 0 0 16px;
      font-size: 0.94rem;
      color: var(--muted);
      line-height: 1.55;
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    .field {
      flex: 1;
      min-width: 120px;
    }

    label {
      display: block;
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 4px;
      color: var(--muted);
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--edge);
      background: #fdfbf6;
      color: var(--ink);
      font-size: 0.92rem;
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }

    input[type="text"]::placeholder {
      color: rgba(107, 94, 82, 0.8);
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-border), 0 8px 18px rgba(155, 27, 27, 0.15);
      background: #fffaf0;
    }

    .toggle-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }

/* Pill toggle base */

.pill-toggle {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 6px 14px;
  font-size: 0.82rem;
  border-radius: 999px;
  border: 1px solid var(--edge);
  background: linear-gradient(180deg, #fdfbf6, #f2ede3);
  color: var(--ink);
  cursor: pointer;
  user-select: none;
  transition:
    background 0.16s ease,
    border-color 0.16s ease,
    color 0.16s ease,
    box-shadow 0.12s ease,
    transform 0.1s ease;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7), var(--shadow-sm);
}

/* weâ€™re not using the inner icon/dot anymore */
.pill-toggle input {
  display: none;
}

.pill-toggle span.dot,
.pill-toggle span.state-icon {
  display: none;
}

/* Label text */
.pill-toggle span.label {
  text-transform: uppercase;
  letter-spacing: 0.18em;
}

/* ON state: orange pill */
.pill-toggle.active {
  background: linear-gradient(180deg, #f8f1e4, #f0e3ce);
  border-color: var(--accent);
  color: var(--ink);
  box-shadow: 0 10px 26px rgba(155, 27, 27, 0.16);
  transform: translateY(-1px);
}

/* OFF state: clear pill */
.pill-toggle:not(.active) {
  background: transparent;
  border-color: var(--edge);
  box-shadow: none;
  transform: none;
  opacity: 1;
}

/* Remove the old drama-only red style */
.pill-toggle.drama.active {
  /* no special override needed anymore */
}


    .flex-between {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin: 12px 0 8px;
    }

    .hint {
      font-size: 0.82rem;
      color: var(--muted);
      font-style: italic;
    }

    .hint strong {
      color: var(--ink);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    button {
      border: none;
      outline: none;
      cursor: pointer;
      font-family: inherit;
    }

    .btn-primary,
    .btn-secondary {
      position: relative;
      padding: 8px 16px;
      font-size: 0.9rem;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.12s ease, opacity 0.12s ease;
      border: 1px solid var(--edge);
      background: #fdfbf6;
      color: var(--ink);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.85), var(--shadow-sm);
    }

    .btn-primary {
      background: linear-gradient(180deg, #f7eee1, #e8d9c4);
      border-color: var(--accent);
      color: var(--ink);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(155, 27, 27, 0.18);
    }

    .btn-secondary {
      background: #fdfbf6;
    }

    .btn-secondary:hover {
      background: #f7eee1;
      box-shadow: 0 10px 20px rgba(31, 26, 23, 0.12);
      transform: translateY(-1px);
    }

    .btn-icon {
      font-size: 1.1rem;
    }

    .btn-ghost {
      padding: 4px 10px;
      border-radius: 8px;
      border: 1px solid var(--edge);
      background: #fdfbf6;
      font-size: 0.78rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-ghost:hover {
      color: var(--ink);
      border-color: var(--accent);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      border: 1px solid var(--edge);
      color: var(--muted);
      background: #fdfbf6;
    }

    .badge span.dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .results-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
    }

    .results-title strong {
      color: var(--ink);
    }

    .event-card {
      background: #fffdf7;
      border-radius: var(--radius-lg);
      border: 1px solid var(--edge);
      padding: 14px 14px 12px;
      margin-bottom: 10px;
      box-shadow: var(--shadow-sm);
      position: relative;
    }

    .event-card::before {
      content: "";
      position: absolute;
      inset: 10px;
      border: 1px dashed rgba(31, 26, 23, 0.18);
      pointer-events: none;
    }

    .event-chip {
      font-size: 0.78rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 4px;
    }

    .event-title {
      margin: 0 0 4px;
      font-size: 1.05rem;
      font-weight: 700;
      color: var(--ink);
    }

    .event-meta {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 6px;
      font-style: italic;
    }

    .event-body {
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--ink);
      margin-bottom: 6px;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 2px;
    }

    .tag {
      font-size: 0.72rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: #fdfbf6;
      border: 1px solid var(--edge);
      color: var(--muted);
    }

    .tag.drama {
      border-color: var(--accent);
      color: var(--accent);
    }

    .tag.wholesome {
      border-color: #2f6f3a;
      color: #2f6f3a;
    }

    .tag.business {
      border-color: #a46a05;
      color: #a46a05;
    }

    .tag.era {
      border-style: dashed;
    }

    .section-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .event-footer-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
    }

    .copy-status {
      font-size: 0.78rem;
      color: var(--muted);
      min-height: 1em;
    }

    .copy-status.ok {
      color: #2f6f3a;
    }

    .copy-status.err {
      color: var(--danger);
    }

    .season-stage-label {
      font-size: 0.76rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .season-stage-label span {
      color: var(--ink);
    }

    .empty-state {
      font-size: 0.9rem;
      color: var(--muted);
      padding: 10px 0 4px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- LEFT: Controls -->
    <div class="panel">
      <div class="panel-inner">
        <h1>
          Drama Engine
          <span class="logo-pill">DBL Â· BBGM Â· ZenGM</span>
        </h1>
        <p class="subtitle">
          Generate era-aware off-court storylines, scandals, and human-interest beats
          for your fictional league or Basketball GM save.
        </p>

        <div class="field-row">
          <div class="field">
            <label for="year">Season Year</label>
            <input id="year" type="number" placeholder="e.g. 1955" />
          </div>
          <div class="field">
            <label for="team">Team</label>
            <input id="team" type="text" placeholder="e.g. Brooklyn Kings" />
          </div>
        </div>

        <div class="field-row">
          <div class="field">
            <label for="star">Star Player</label>
            <input id="star" type="text" placeholder="e.g. Howard Barber" />
          </div>
          <div class="field">
            <label for="tone">Universe / Tone</label>
            <select id="tone">
              <option value="dbl">DBL Alt-History</option>
              <option value="modern">Modern NBA-ish</option>
              <option value="generic">Generic / Sandbox</option>
            </select>
          </div>
        </div>

        <div class="flex-between">
          <div class="section-label">Event Types</div>
          <div class="hint">
            Toggle what kind of trouble or vibes the generator can use.
          </div>
        </div>

        <div class="toggle-group" id="typeToggles">
          <label class="pill-toggle drama active" data-type="drama" role="button" aria-pressed="true" tabindex="0">
            <span class="label">Drama</span>
          </label>
          <label class="pill-toggle active" data-type="wholesome" role="button" aria-pressed="true" tabindex="0">
            <span class="label">Feel-Good</span>
          </label>
          <label class="pill-toggle active" data-type="business" role="button" aria-pressed="true" tabindex="0">
            <span class="label">Business</span>
          </label>
          <label class="pill-toggle active" data-type="random" role="button" aria-pressed="true" tabindex="0">
            <span class="label">Wildcard</span>
          </label>
        </div>

        <div class="flex-between">
          <div class="section-label">Generate</div>
          <div class="hint">
            <strong>Tip:</strong> Re-roll until something clicks, then tweak names.
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-primary" id="btnGenerate">
            <span class="btn-icon">ðŸŽ²</span>
            <span>Single Event</span>
          </button>
          <button class="btn-secondary" id="btnSeasonArc">
            <span class="btn-icon">ðŸ“–</span>
            <span>Season Arc (4 beats)</span>
          </button>
        </div>

        <button class="btn-ghost" id="btnReset">
          <span class="btn-icon">ðŸ§¹</span>
          <span>Reset fields</span>
        </button>
      </div>
    </div>

    <!-- RIGHT: Results -->
    <div class="panel">
      <div class="panel-inner">
        <div class="results-header">
          <div class="results-title">
            Current Output Â· <strong id="outputCountLabel">None yet</strong>
          </div>
          <div class="badge">
            <span class="dot"></span>
            <span id="eraLabel">Era: â€”</span>
          </div>
        </div>

        <div id="results">
          <div class="empty-state">
            Hit <strong>Single Event</strong> or <strong>Season Arc</strong> to
            generate DBL-style flavor text. You can copy it right into your wiki,
            BBGM note, or Discord write-up.
          </div>
        </div>

        <div class="event-footer-row" style="margin-top: 10px;">
          <div id="copyStatus" class="copy-status"></div>
          <button class="btn-ghost" id="btnCopyAll">
            <span class="btn-icon">ðŸ“‹</span>
            <span>Copy all to clipboard</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Era + event library ----------------------------------------------

    function pick(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function getEraBucket(year) {
      if (!year || isNaN(year)) return { key: "generic", label: "Any era" };
      year = Number(year);

      if (year <= 1939) return { key: "pre40s", label: "1910sâ€“1930s barnstorm era" };
      if (year <= 1959) return { key: "fifties", label: "1950s early pro era" };
      if (year <= 1979) return { key: "seventies", label: "1960sâ€“70s expansion era" };
      if (year <= 1999) return { key: "nineties", label: "1980sâ€“90s TV/brand boom" };
      if (year <= 2010) return { key: "twoKs", label: "2000s tabloid / reality era" };
      if (year <= 2020) return { key: "tens", label: "2010s social media era" };
      return { key: "twenties", label: "2020s load-management / player-empowerment era" };
    }

    // Each entry is { type, tone, title, body, tags }
    // body can use {{team}} and {{star}} and {{year}}
    const EVENT_LIBRARY = {
      // Low-level, pre-real-NBA vibes: trains, mills, town gyms, wars.
      pre40s: [
        {
          type: "wholesome",
          tone: "dbl",
          title: "Mill Shift to Midnight Tip-Off",
          body:
            "With factories refusing to adjust work hours, {{team}} quietly moves a home game to 11:30 p.m. so {{star}} and three other starters can clock out of the night shift and still make tip-off. The bleachers are filled with workers in dusty uniforms, turning the gym into a roaring after-hours rally.",
          tags: ["scheduling oddity", "working-class roots", "home-court vibe"]
        },
        {
          type: "random",
          tone: "dbl",
          title: "Barn Roof Leak Delay",
          body:
            "A rainstorm pounds the roof of {{team}}â€™s wooden barn gym, and water drips onto the key just before halftime. Volunteers scramble with buckets and sawdust while {{star}} jokes with fans seated feet away. The league allows play to resume on a slightly shrunken court, adding a quirky footnote to {{year}} box scores.",
          tags: ["arena quirk", "weather", "home advantage"]
        },
        {
          type: "drama",
          tone: "dbl",
          title: "Small-Town Rivalry Spills into the Stands",
          body:
            "A long-simmering feud between two local factories boils over when traveling {{team}} fans clash with hostile locals during a packed barnstorming stop. Security is basically two tired sheriffs and a high-school coach, leaving {{star}} to help escort teammates through a hail of shouted insults and tossed programs.",
          tags: ["crowd trouble", "road hostility", "reputation"]
        },
        {
          type: "business",
          tone: "dbl",
          title: "Train Ticket Sponsorshipâ€¦ Sort Of",
          body:
            "In {{year}}, nobody is throwing shoe money at {{team}}, but the local rail company agrees to comp third-class tickets if the club poses for a publicity photo on the platform. {{star}} ends up front-and-center in newspaper ads as 'the face of modern travel' despite not owning so much as a suitcase.",
          tags: ["proto-sponsorship", "travel", "media"]
        },
        {
          type: "random",
          tone: "dbl",
          title: "Gym Lightbulb Crisis",
          body:
            "Minutes before tip-off, half the bulbs in the tiny {{team}} home gym burn out at once. Rather than cancel, the league lets the game go on in a dim half-light. {{star}} jokes later that it was 'like playing in a cave' and blames a poor shooting night on not being able to see the rim.",
          tags: ["arena quirk", "home-court legend"]
        }
      ],

      // 1950s: trains/planes, early media, segregation, military service, mob owners.
      fifties: [
        {
          type: "drama",
          tone: "dbl",
          title: "Red-Eye Road Trip Meltdown",
          body:
            "A brutal back-to-back leaves {{team}} stranded overnight when their connecting train is delayed by a snowstorm. Half the roster sleeps sitting up in a freezing station while {{star}} and a few veterans argue loudly with league officials over the schedule. By the time they arrive for the {{year}} showdown, tempers are running hotter than the arena lights.",
          tags: ["travel chaos", "scheduling", "locker-room tension"]
        },
        {
          type: "wholesome",
          tone: "dbl",
          title: "Free Clinic at the Neighborhood Playground",
          body:
            "On an off-day in {{year}}, {{star}} organizes an impromptu clinic at a cracked concrete playground near {{team}}â€™s home arena. Kids line up around the block to get a handshake and a jump-shot tip. The local paper catches the scene and runs a photo spread that makes {{star}} an instant community icon.",
          tags: ["community", "public image", "fan connection"]
        },
        {
          type: "random",
          tone: "dbl",
          title: "Team Photo Interrupted by Air Raid Drill",
          body:
            "Minutes before a scheduled team portrait, arena staff receives notice of a mandatory air raid drill. {{team}} hustles into the basement while photographers wait upstairs. When everyone returns twenty minutes later, the smiles look a little tighter, and the resulting photo becomes an odd historical artifact of {{year}} basketball life.",
          tags: ["wartime backdrop", "logistics", "team memory"]
        },
        {
          type: "business",
          tone: "dbl",
          title: "Suit-and-Tie Endorsement Deal",
          body:
            "A local clothier signs {{star}} to a modest endorsement: three custom suits and a tiny stipend in exchange for 'gentlemanly representation of the brand.' {{star}} shows up in a sharp new look that draws compliments from press and teammates â€” and quiet eye-rolls from veterans who still travel in work jackets.",
          tags: ["early endorsement", "image", "locker-room teasing"]
        },
        {
          type: "random",
          tone: "dbl",
          title: "Military Service Shadow",
          body:
            "As tensions overseas ripple through {{year}}, rumors swirl that {{star}} could be called into service at any moment. {{team}} quietly holds internal meetings about emergency contingency plans. No one speaks about it publicly, but reporters note a different kind of weight in {{star}}â€™s post-game interviews.",
          tags: ["real-world context", "uncertainty", "mental load"]
        }
      ],

      // 60sâ€“70s: counterculture, nightlife, ABA-style chaos.
      seventies: [
        {
          type: "drama",
          tone: "generic",
          title: "Nightclub Photo Sparks League Fine",
          body:
            "A blurry newspaper photo surfaces of {{star}} leaving a downtown nightclub at 3 a.m. the night before a national TV game. The league quietly issues a fine for 'conduct unbecoming,' while {{team}} scrambles to keep the focus on the court after a sluggish first half.",
          tags: ["nightlife", "league discipline", "media"]
        },
        {
          type: "wholesome",
          tone: "generic",
          title: "Peace-Sign Warmups",
          body:
            "In a subtle nod to the era, {{team}} takes the floor for a Sunday matinee in matching warm-ups stitched with small peace symbols. {{star}} leads the idea, insisting basketball should be 'a place where everybody sits in the same bleachers.' Some older fans grumble, but the younger crowd loves it.",
          tags: ["culture", "team unity", "fans"]
        },
        {
          type: "business",
          tone: "generic",
          title: "Rival League Flirtation",
          body:
            "A flashy upstart league sends scouts to {{team}}â€™s games and leaks that theyâ€™re preparing a massive offer for {{star}}. Negotiations become a season-long soap opera as rumors of colorful uniforms, wild rules, and fat contracts swirl around the locker room.",
          tags: ["rival league", "contract drama", "uncertainty"]
        },
        {
          type: "random",
          tone: "generic",
          title: "Music Takes Over the Locker Room",
          body:
            "A rookie brings a booming portable stereo on the road, turning the {{team}} locker room into a swirling mix of funk, rock, and soul. {{star}} initially hates it but eventually picks a walk-out song that becomes a low-key superstition for the whole {{year}} campaign.",
          tags: ["culture shift", "rookie influence", "team rituals"]
        },
        {
          type: "wholesome",
          tone: "generic",
          title: "Community Garden Appearance",
          body:
            "Between road trips, {{team}} spends a morning planting saplings at a local community garden. {{star}} ends up giving an impromptu clinic on box-out footwork to kids who wandered over from the playground next door, and the story becomes a charming side note in the Sunday paper.",
          tags: ["community", "off-day", "team bonding"]
        }
      ],

      // 80sâ€“90s: TV, sneakers, tabloids, early mega-stars.
      nineties: [
        {
          type: "drama",
          tone: "modern",
          title: "Late-Night Hotel Incident",
          body:
            "Tabloid reporters camp outside the team hotel after a noise complaint draws security to {{star}}â€™s floor at 2 a.m. Details are fuzzy and the official line is 'miscommunication,' but cameras catch {{star}} looking exhausted and irritated at shootaround. The story dominates highlight shows for three days.",
          tags: ["tabloids", "distraction", "media circus"]
        },
        {
          type: "business",
          tone: "modern",
          title: "Signature Sneaker Tug-of-War",
          body:
            "Two shoe companies push competing offers at {{star}} after a breakout playoff run. {{team}}â€™s front office quietly worries the branding war will overshadow their small-market vibe. A leaked fax showing {{year}} sales projections sends fan message boards into a frenzy.",
          tags: ["endorsements", "big money", "small-market tension"]
        },
        {
          type: "wholesome",
          tone: "modern",
          title: "Make-A-Wish Game Day",
          body:
            "Before a crucial home game, {{star}} spends an hour with a young fan battling illness who dreamed of meeting the whole {{team}} roster. The child sits courtside in a custom jersey and joins the huddle pre-tip. When {{star}} drops a season-high performance, local news frames it as 'the wish that powered a miracle night.'",
          tags: ["community", "heartwarming", "media spotlight"]
        },
        {
          type: "random",
          tone: "modern",
          title: "Video Game Rating Controversy",
          body:
            "The new {{year}} basketball video game drops and assigns {{star}} what many consider a disrespectful rating. {{team}}â€™s locker room roasts the number relentlessly. In one post-game interview, {{star}} jokes that theyâ€™re 'on a season-long quest to patch the rating in real life.'",
          tags: ["pop culture", "motivation", "locker-room jokes"]
        },
        {
          type: "drama",
          tone: "modern",
          title: "Tabloid Learns About Closed-Door Meeting",
          body:
            "After a bad stretch, {{team}} holds a players-only summit to clear the air. Hours later, a tabloid columnist publishes eerily specific details about speeches and confrontations. Fingers point toward {{star}}â€™s agent circle, and trust feels fragile heading into the playoff push.",
          tags: ["leaks", "trust issues", "media circus"]
        },
        {
          type: "business",
          tone: "modern",
          title: "Franchise Legends Night Negotiation",
          body:
            "{{team}} plans a nostalgia-heavy Legends Night and wants {{star}} to wear a throwback jersey for warmups. {{star}}â€™s apparel partner balks at the vintage logo, sparking a three-way conversation between the sponsor, team, and league office about who controls the look. The compromise creates a limited-edition line that sells out in minutes.",
          tags: ["branding", "merch", "team history"]
        }
      ],

      // 2000s: internet, leaks, reality TV.
      twoKs: [
        {
          type: "drama",
          tone: "modern",
          title: "Anonymous Message Board Insider",
          body:
            "Throughout the {{year}} season, an anonymous message board account drops eerily accurate details about {{team}} practices and minor injuries. Fans assume itâ€™s a staffer, but whispers inside the organization suggest a young player â€” maybe even {{star}} â€” is venting online.",
          tags: ["internet era", "leaks", "trust issues"]
        },
        {
          type: "business",
          tone: "modern",
          title: "Reality Show Cameo Offer",
          body:
            "A cable network approaches {{star}} about appearing on a reality show set in {{team}}â€™s city. The front office worries the cameras will follow into the locker room. After weeks of back-and-forth, they strike a deal: off-court footage only â€” but the distraction lingers all year.",
          tags: ["media", "brand building", "distraction"]
        },
        {
          type: "wholesome",
          tone: "modern",
          title: "Charity Three-Point Marathon",
          body:
            "{{star}} volunteers to shoot threes for charity, with local sponsors donating for every make over an hour. Teammates join in, turning the gym into a carnival atmosphere. The event raises more than anyone expected and becomes an annual {{team}} tradition.",
          tags: ["charity", "fan engagement", "tradition"]
        },
        {
          type: "random",
          tone: "modern",
          title: "Team Bus Prank War",
          body:
            "A harmless prank with icy water on the team bus turns into a month-long escalation of jokes and props. Coaches eventually step in after someone swaps the pre-game playlist with cartoon theme songs just as {{team}} arrives for a national TV matchup.",
          tags: ["chemistry", "humor", "coach intervention"]
        },
        {
          type: "wholesome",
          tone: "modern",
          title: "Teammates Crash a Classroom",
          body:
            "While visiting a local school, {{star}} FaceTimes teammates from a classroom so kids can ask questions. Two veterans sneak away from practice treatment to join the call, leading to a viral clip of the whole roster joking with the students and promising to dedicate their next win to the class.",
          tags: ["community", "team chemistry", "viral moment"]
        },
        {
          type: "drama",
          tone: "modern",
          title: "Trade Rumor Blog Frenzy",
          body:
            "An early sports blog publishes an unsourced post claiming {{star}} wants out of {{team}}. Local radio hosts pick it up, fans print 'Stay {{star}}' signs, and the locker room fields questions for weeks. The GM eventually invites the blogger to practice for an awkward face-to-face clarification.",
          tags: ["rumors", "early internet", "front office"]
        }
      ],

      // 2010s: social media, players as brands, superteams.
      tens: [
        {
          type: "drama",
          tone: "modern",
          title: "Tweet Storm After Tough Loss",
          body:
            "Moments after a crushing defeat, {{star}} fires off a series of cryptic late-night posts about 'effort' and 'trust.' Screenshots flood feeds before anything can be deleted. When reporters ask about it the next morning, {{star}} insists they were 'just talking about life,' but everyone in {{team}}â€™s locker room knows better.",
          tags: ["social media", "locker-room tension", "PR handling"]
        },
        {
          type: "business",
          tone: "modern",
          title: "Player-Run Skills Camp Brand",
          body:
            "Leveraging a breakout {{year}} campaign, {{star}} quietly launches a branded off-season skills camp. The logo shares suspiciously similar colors with {{team}} jerseys. Front office execs debate whether to lean into the brand or keep team identity separate.",
          tags: ["player brand", "off-season business", "identity"]
        },
        {
          type: "wholesome",
          tone: "modern",
          title: "Viral Tunnel Moment",
          body:
            "A video of {{star}} greeting arena staff by name in the tunnel pre-game goes viral. Fans latch onto the clip as proof that {{team}} has 'the most grounded star in the league.' Merch sales spike for a week off the back of one candid camera angle.",
          tags: ["viral moment", "public image", "fan love"]
        },
        {
          type: "random",
          tone: "modern",
          title: "Superteam Rumors Swirl",
          body:
            "An off-hand remark on a podcast about 'linking up with some guys' sends rumor mills into overdrive. Fans draw up photoshop jerseys of {{star}} in half the leagueâ€™s colors. {{team}} spends the next month answering questions about loyalty and long-term direction.",
          tags: ["free agency", "speculation", "media noise"]
        },
        {
          type: "wholesome",
          tone: "modern",
          title: "Arena Staff Scholarship Surprise",
          body:
            "During a pregame tunnel walk, {{star}} announces that their foundation will fund college tuition for a longtime arena employeeâ€™s child. The league office highlights the gesture, turning a brief clip into a feel-good headline across the sports world.",
          tags: ["community", "player foundation", "viral moment"]
        }
      ],

      // 2020s: load management, pandemic residue, player podcasts, NIL world, etc.
      twenties: [
        {
          type: "drama",
          tone: "modern",
          title: "Load Management Backlash",
          body:
            "When {{team}} announces a rest night for {{star}} in {{year}} during a highly anticipated road game, opposing fans erupt online. Video of disappointed kids in {{star}} jerseys gains traction, forcing {{team}} to roll out a full-blown PR campaign explaining the sports-science logic behind the decision.",
          tags: ["load management", "sports science", "fan optics"]
        },
        {
          type: "business",
          tone: "modern",
          title: "Player-Hosted Podcast Bombshells",
          body:
            "{{star}} launches a podcast mid-season and, in episode two, casually reveals behind-the-scenes locker-room stories about {{team}} from earlier in the year. Clips go viral, and coaches quietly request an 'editing approval' process going forward.",
          tags: ["player media", "storytelling", "leaks"]
        },
        {
          type: "wholesome",
          tone: "modern",
          title: "City-Wide Mutual Aid Drive",
          body:
            "In the wake of a local crisis, {{star}} organizes a city-wide mutual aid drive, using their platform to connect fans with food banks and shelters. {{team}} follows their lead, matching donations and turning the arena concourse into a distribution hub.",
          tags: ["community", "leadership", "real-world impact"]
        },
        {
          type: "random",
          tone: "modern",
          title: "Headset Glitch on Live Broadcast",
          body:
            "During a wired-for-sound segment, a sideline mic accidentally picks up {{star}} and a teammate debating which arena has the worst visiting locker room. The clip makes the rounds all week, giving every opponent bulletin-board material.",
          tags: ["broadcast", "unfiltered", "league chatter"]
        },
        {
          type: "business",
          tone: "modern",
          title: "In-Season Docuseries Negotiation",
          body:
            "Streaming cameras appear at practice after {{team}} entertains a midseason documentary deal. Coaches worry about strategy leaking, while {{star}} argues the spotlight could boost charity projects. The team eventually sets strict boundaries, creating a new playbook for modern content control.",
          tags: ["media", "access", "player empowerment"]
        },
        {
          type: "random",
          tone: "modern",
          title: "AR Jersey Launch Glitches",
          body:
            "{{team}} debuts an augmented-reality jersey experience that lets fans scan {{star}}â€™s number to unlock highlights. On release night the app crashes, leaving fans stuck on a loading screen while players joke about 'buffering mid-layup.' Developers scramble to patch the rollout before the next homestand.",
          tags: ["tech", "fan engagement", "launch hiccup"]
        }
      ],

      // Fallback/generic pool if nothing else matches.
      generic: [
        {
          type: "drama",
          tone: "generic",
          title: "Practice Dust-Up",
          body:
            "A heated scrimmage turns into a shoving match between {{star}} and a frustrated teammate. Voices are raised, a ball gets spiked into the rafters, and {{team}} briefly shuts practice to cool everyone down. By the next game, both players insist theyâ€™re 'on the same page' â€” but fans start reading body language on every timeout huddle.",
          tags: ["internal tension", "competitive fire", "chemistry watch"]
        },
        {
          type: "wholesome",
          tone: "generic",
          title: "Birthday Surprise in the Locker Room",
          body:
            "Teammates ambush {{star}} with a cake, confetti, and an off-key rendition of 'Happy Birthday' after shootaround. The video winds up on team channels and becomes a fan-favorite glimpse into the lighter side of {{team}}â€™s season.",
          tags: ["team bond", "locker-room", "fans"]
        },
        {
          type: "business",
          tone: "generic",
          title: "Arena Naming Rights Shake-Up",
          body:
            "Mid-season, {{team}}â€™s home gets a new naming-rights partner, complete with a rebranded logo at center court. {{star}} jokingly stumbles over the new arena name in an interview, and the clip becomes a meme that even the sponsor leans into.",
          tags: ["business", "branding", "fan culture"]
        },
        {
          type: "random",
          tone: "generic",
          title: "Strange Pre-Game Superstition Emerges",
          body:
            "After a big win on a random Tuesday, {{team}} realizes they all ate from the same pre-game snack table. {{star}} insists they keep the exact same routine the next few games â€” down to the brand of chips â€” sparking a short-lived but beloved superstition among fans.",
          tags: ["superstition", "routine", "fun"]
        },
        {
          type: "wholesome",
          tone: "generic",
          title: "Late-Night Arena Cleanup",
          body:
            "When an understaffed arena crew struggles to reset the court after a charity event, several {{team}} players grab brooms and help. {{star}} stays the longest, chatting with workers about their favorite games. A janitorâ€™s cell-phone video of the cleanup night becomes a surprise hit online.",
          tags: ["community", "humility", "behind the scenes"]
        },
        {
          type: "random",
          tone: "generic",
          title: "Equipment Truck Goes Missing",
          body:
            "Hours before a road game, {{team}} learns the equipment truck took a wrong exit and is stuck in traffic miles away. Coaches improvise warmups with borrowed balls while staff rushes to retrieve jerseys. When {{star}} scores 30 in mismatched socks, the story becomes instant road-trip lore.",
          tags: ["travel", "improvise", "road life"]
        }
      ]
    };

    function getPool(year, tone, allowedTypes) {
      const era = getEraBucket(year);
      const pools = [];

      function pushEvents(key) {
        if (EVENT_LIBRARY[key]) pools.push(...EVENT_LIBRARY[key]);
      }

      // Era-specific
      pushEvents(era.key);
      // Fallback
      pushEvents("generic");

      return pools.filter(ev => allowedTypes.includes(ev.type) &&
        (tone === "generic" || ev.tone === tone || ev.tone === "generic"));
    }

    // --- UI wiring ---------------------------------------------------------

    const yearInput = document.getElementById("year");
    const teamInput = document.getElementById("team");
    const starInput = document.getElementById("star");
    const toneSelect = document.getElementById("tone");
    const btnGenerate = document.getElementById("btnGenerate");
    const togglesRoot = document.getElementById("typeToggles");
    togglesRoot.querySelectorAll(".pill-toggle").forEach(label => {
      label.addEventListener("click", () => toggleFromLabel(label));

      label.addEventListener("keydown", (e) => {
        if (e.key !== "Enter" && e.key !== " ") return;
        e.preventDefault();
        toggleFromLabel(label);
      });
    });
    const btnSeasonArc = document.getElementById("btnSeasonArc");
    const btnReset = document.getElementById("btnReset");
    const btnCopyAll = document.getElementById("btnCopyAll");
    const resultsEl = document.getElementById("results");
    const eraLabelEl = document.getElementById("eraLabel");
    const outputCountLabel = document.getElementById("outputCountLabel");
    const copyStatusEl = document.getElementById("copyStatus");

    function getSelectedTypes() {
      const labels = togglesRoot.querySelectorAll(".pill-toggle");
      const types = [];
      labels.forEach(label => {
        if (label.classList.contains("active")) {
          types.push(label.dataset.type);
        }
      });
      return types.length ? types : ["random"];
    }

    // turn pill on/off visually and logically
    function setToggleState(label, active) {
      label.classList.toggle("active", active);
      label.setAttribute("aria-pressed", active ? "true" : "false");
    }

    // handles a user click
    function toggleFromLabel(label) {
      const next = !label.classList.contains("active");
      setToggleState(label, next);
      persistState();
    }

    function formatEvent(ev, year, team, star, stageLabel = null, index = 0) {
      const safeYear = year || "Year ?";
      const safeTeam = team || "the club";
      const safeStar = star || "their star player";

      const body = ev.body
        .replace(/{{year}}/g, safeYear)
        .replace(/{{team}}/g, safeTeam)
        .replace(/{{star}}/g, safeStar);

      const tags = ev.tags || [];

      const stageHtml = stageLabel
        ? `<div class="season-stage-label">Season Beat <span>${stageLabel}</span></div>`
        : "";

      const tagHtml = tags.map(t => {
        const lower = t.toLowerCase();
        let cls = "tag";
        if (lower.includes("drama") || lower.includes("tension") || lower.includes("backlash")) {
          cls += " drama";
        } else if (lower.includes("wholesome") || lower.includes("community") || lower.includes("heartwarming")) {
          cls += " wholesome";
        } else if (lower.includes("business") || lower.includes("contract") || lower.includes("brand")) {
          cls += " business";
        }
        return `<span class="${cls}">${t}</span>`;
      }).join("");

      return `
        <article class="event-card">
          ${stageHtml}
          <div class="event-chip">${safeYear} Â· ${safeTeam}</div>
          <h2 class="event-title">${ev.title}</h2>
          <div class="event-meta">Focus: ${safeStar}</div>
          <div class="event-body">${body}</div>
          <div class="tag-row">
            ${tagHtml}
          </div>
        </article>
      `;
    }

    function updateEraLabel(year) {
      const bucket = getEraBucket(year);
      eraLabelEl.textContent = `Era: ${bucket.label}`;
    }

    function renderSingleEvent() {
      const year = yearInput.value.trim();
      const team = teamInput.value.trim();
      const star = starInput.value.trim();
      const tone = toneSelect.value;
      const types = getSelectedTypes();
      const pool = getPool(year, tone, types);

      if (!pool.length) {
        resultsEl.innerHTML = `
          <div class="empty-state">
            No events matched your filters (tone + types) for this era just yet.
            Try enabling more event types or switching the universe tone.
          </div>
        `;
        outputCountLabel.textContent = "0 events";
        return;
      }

      const ev = pick(pool);
      resultsEl.innerHTML = formatEvent(ev, year, team, star);
      outputCountLabel.textContent = "1 event";
      updateEraLabel(year);
      persistState();
      clearCopyStatus();
    }

    function renderSeasonArc() {
      const year = yearInput.value.trim();
      const team = teamInput.value.trim();
      const star = starInput.value.trim();
      const tone = toneSelect.value;
      const types = getSelectedTypes();
      const pool = getPool(year, tone, types);

      if (!pool.length) {
        resultsEl.innerHTML = `
          <div class="empty-state">
            No events matched your filters (tone + types) for this era just yet.
            Try enabling more event types or switching the universe tone.
          </div>
        `;
        outputCountLabel.textContent = "0 events";
        return;
      }

      const stages = [
        "Off-Season Spark",
        "Early-Season Vibes",
        "Midseason Turning Point",
        "Playoff Fallout"
      ];

      let html = "";
      for (let i = 0; i < stages.length; i++) {
        const ev = pick(pool);
        html += formatEvent(ev, year, team, star, stages[i], i);
      }

      resultsEl.innerHTML = html;
      outputCountLabel.textContent = "4 events";
      updateEraLabel(year);
      persistState();
      clearCopyStatus();
    }

    function resetFields() {
      yearInput.value = "";
      teamInput.value = "";
      starInput.value = "";
      toneSelect.value = "dbl";
      // Turn all toggles on
      togglesRoot.querySelectorAll(".pill-toggle").forEach(label => {
        setToggleState(label, true);
      });
      updateEraLabel(null);
      resultsEl.innerHTML = `
        <div class="empty-state">
          Fields reset. Pick a season year, team, and star â€” then let the drama engine
          cook up something for your universe.
        </div>
      `;
      outputCountLabel.textContent = "None yet";
      clearCopyStatus();
      persistState();
    }

    function copyAllToClipboard() {
      const textPieces = [];
      const year = yearInput.value.trim() || "Year ?";
      const team = teamInput.value.trim() || "Team";
      const star = starInput.value.trim() || "Star Player";

      textPieces.push(`${year} Â· ${team}`);
      textPieces.push(`Focus: ${star}`);
      textPieces.push("");

      const cards = resultsEl.querySelectorAll(".event-card");
      if (!cards.length) {
        setCopyStatus("No events to copy yet.", false);
        return;
      }

      cards.forEach((card, idx) => {
        const title = card.querySelector(".event-title")?.textContent ?? "";
        const meta = card.querySelector(".event-meta")?.textContent ?? "";
        const body = card.querySelector(".event-body")?.textContent ?? "";
        const tags = Array.from(card.querySelectorAll(".tag")).map(t => t.textContent.trim());

        if (idx > 0) textPieces.push("â€” â€” â€”");
        const stageLabel = card.querySelector(".season-stage-label")?.textContent ?? null;
        if (stageLabel) textPieces.push(stageLabel.trim());
        textPieces.push(title);
        if (meta) textPieces.push(meta);
        textPieces.push(body);
        if (tags.length) textPieces.push("Tags: " + tags.join(", "));
      });

      const text = textPieces.join("\n");

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => setCopyStatus("Copied all events to clipboard.", true))
          .catch(() => setCopyStatus("Couldn't access clipboard â€” you can still select and copy manually.", false));
      } else {
        setCopyStatus("Clipboard API not available â€” select and copy manually.", false);
      }
    }

    function setCopyStatus(msg, ok) {
      copyStatusEl.textContent = msg;
      copyStatusEl.classList.toggle("ok", !!ok);
      copyStatusEl.classList.toggle("err", !ok);
    }

    function clearCopyStatus() {
      copyStatusEl.textContent = "";
      copyStatusEl.classList.remove("ok", "err");
    }

    // --- Persistence (localStorage) ----------------------------------------

    const STORAGE_KEY = "dblDramaEngineState";

    function persistState() {
      const state = {
        year: yearInput.value.trim(),
        team: teamInput.value.trim(),
        star: starInput.value.trim(),
        tone: toneSelect.value,
        types: getSelectedTypes()
      };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        // ignore
      }
    }

    function restoreState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const state = JSON.parse(raw);
        if (state.year) yearInput.value = state.year;
        if (state.team) teamInput.value = state.team;
        if (state.star) starInput.value = state.star;
        if (state.tone) toneSelect.value = state.tone;

        // Apply toggle state
        if (Array.isArray(state.types) && state.types.length) {
          togglesRoot.querySelectorAll(".pill-toggle").forEach(label => {
            const type = label.dataset.type;
            const active = state.types.includes(type);
            setToggleState(label, active);
          });
        } else {
          // Ensure initial aria state matches default toggles
          togglesRoot.querySelectorAll(".pill-toggle").forEach(label => {
            setToggleState(label, label.classList.contains("active"));
          });
        }
        updateEraLabel(state.year || null);
      } catch (e) {
        // ignore
      }
    }

    // --- Event listeners ---------------------------------------------------

    btnGenerate.addEventListener("click", renderSingleEvent);
    btnSeasonArc.addEventListener("click", renderSeasonArc);
    btnReset.addEventListener("click", resetFields);
    btnCopyAll.addEventListener("click", copyAllToClipboard);

    // Persist on key changes
    [yearInput, teamInput, starInput, toneSelect].forEach(el => {
      el.addEventListener("change", () => {
        if (el === yearInput) updateEraLabel(yearInput.value.trim());
        persistState();
      });
      el.addEventListener("blur", persistState);
    });

    // Initialize
    restoreState();
    if (!yearInput.value) {
      const currentYear = new Date().getFullYear();
      yearInput.value = currentYear;
      updateEraLabel(currentYear);
    }
  </script>
</body>
</html>


